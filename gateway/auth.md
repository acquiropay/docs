# Проведение платежа

[[toc]]

## Параметры запроса

### Обязательные параметры

| Название     | Тип     | Обязательность                             | Описание                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|--------------|---------|--------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| opcode       | integer | Да                                         | Для проведения платежа - 0.                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| product_id   | integer | Да                                         | Идентификатор оплачиваемого продукта.                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| amount       | float   | Да, если продукт объявлен как "FREE_PRICE" | Сумма к оплате в валюте продукта.  Валюта продукта указывается в настройках продукта.                                                                                                                                                                                                                                                                                                                                                                                 |
| cf           | string  | Да                                         | Свободное поле. Поле должно содержать информацию о плательщике.  Например, в поле можно передать номер заказа (номер договора, номер лицевого счета, номер телефона и др.) Если никаких параметров, содержащих информацию о плательщике, нет, то при интеграции необходимо согласовать значение поля с сотрудниками МФР. Записанная информация будет передана обратно Торговцу в callback-ах или при запросе статуса транзакции. Поле cf не может иметь значение «0». |
| ip_address   | string  | Да                                         | Текстовое значение IPv4, например: 80.80.80.80.                                                                                                                                                                                                                                                                                                                                                                                                                       |
| pp_identity  | string  | Да                                         | Идентификатор платежной системы.                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| token        | string  | Да                                         | Идентификатор безопасности. MD5 (merchant_id + product_Id + amount + cf +cf2 + cf3 + secret_word)                                                                                                                                                                                                                                                                                                                                                                     |                                                                                                                                                                                                                                                                                                                                                                |   |                                                                                                                                                                                                                                                                                                                                                                                                   |

### Параметры при оплате банковской картой

| Название    | Тип     | Обязательность | Описание                                                     |
|-------------|---------|----------------|--------------------------------------------------------------|
| pan         | integer | Да             | Номер банковской карты.                                      |
| cardholder  | string  | Да             | Имя держателя карты.                                         |
| exp_month   | string  | Да             | Срок действия банковской карты - месяц. Формат - MM.         |
| exp_year    | string  | Да             | Срок действия банковской карты - год. Формат - YYYY.         |
| cvv         | int     | Да             | CVC/CVV2 - секретный код банковской карты.                   |
| pp_identity | string  | Да             | Идентификатор платежной системы. Для банковских карт - card. |

### Дополнительные параметры

| Название              | Тип     | Обязательность | Описание                                                                                                                                                                                                                                                                                                            |
|-----------------------|---------|----------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| product_name          | string  | Нет            | Название продукта / назначение платежа.                                                                                                                                                                                                                                                                             |
| cf2                   | string  | Нет            | Свободное поле 2.                                                                                                                                                                                                                                                                                                   |
| cf3                   | string  | Нет            | Свободное поле 2                                                                                                                                                                                                                                                                                                    |
| first_name            | string  | Нет            | Имя плательщика.                                                                                                                                                                                                                                                                                                    |
| last_name             | string  | Нет            | Фамилия плательщика.                                                                                                                                                                                                                                                                                                |
| zip                   | string  | Нет            | Индекс плательщика.                                                                                                                                                                                                                                                                                                 |
| country               | string  | Нет            | Страна проживания плательщика. 3-х буквенный ISO-код ([ISO 3166-1 alpha-3](https://en.wikipedia.org/wiki/ISO_3166-1_alpha-3))                                                                                                                                                                                       |
| region                | string  | Нет            | Регион проживания плательщика. Свободный формат, но можно также передавать код региона согласно ISO ([ISO 3166-2](https://en.wikipedia.org/wiki/ISO_3166-2))                                                                                                                                                        |
| city                  | string  | Нет            | Город проживания плательщика.                                                                                                                                                                                                                                                                                       |
| address               | string  | Нет            | Адрес плательщика без страны и региона.                                                                                                                                                                                                                                                                             |
| email                 | string  | Нет            | E-Mail плательщика.                                                                                                                                                                                                                                                                                                 |
| phone                 | string  | Нет            | Номер телефона плательщика в формате [E.164](https://en.wikipedia.org/wiki/E.164)                                                                                                                                                                                                                                   |
| cb_url                | string  | Нет            | URL для осуществления callback запроса.                                                                                                                                                                                                                                                                             |
| user_rebill_app roved | integer | Нет            | Если далее необходимо будет использовать данные первичной операции для повторных списаний, то передаётся данный параметр. Он обозначает, что Плательщик на форме поставил галочку, что он согласен на проведение повторных операций на основании первой авторизации. 1 - согласен 0 (или отсутствует) – не согласен |
| user_rebill_freq      | integer | Нет            | Частота проведения повторных операций. По-умолчанию, значение = 1 – каждый день.                                                                                                                                                                                                                                    |
| user_rebill_exp       | string  | Нет            | Дата действия в формате YYYYMM. По-умолчанию, значение = сроку действия карты.                                                                                                                                                                                                                                      |

## Ответ

### Описание возвращаемых данных

| Название            | Тип    | Описание                                                                                             |
|---------------------|--------|------------------------------------------------------------------------------------------------------|
| payment_id          | string | Идентификатор платежа.                                                                               |
| datetime            | string | Дата и время начала операции в текущем статусе по часовому поясу UTC в формате YYYY-MM-DD hh:mm:ssZ. |
| status              | string | Состояние платежа (см. [справочник](/gateway/dictionary.md)).                                        |
| pp_identity         | string | Идентификатор платежной системы.                                                                     |
| cf                  | string | Свободное поле.                                                                                      |
| cf2                 | string | Свободное поле 2.                                                                                    |
| additional          | array  | Дополнительные параметры.                                                                            |
| additional/secure3d | array  | Параметры для отправки на ACS банк-эмитента для авторизации через 3D-Secure.                         |

### Требуется 3DS авторизация

#### Пример ответа

```xml
<response>
    <payment_id>784093adb49a43e9b89a63807d780acb</payment_id>
    <status>3DSECURE</status>
    <extended_id>784093adb49a43e9b89a63807d780acb</extended_id>
    <extended_status>3DSECURE</extended_status
    <transaction_status>3DSECURE</transaction_status>    
    <datetime>2011-04-28 11:52:15.0</datetime>
    <duplicate>false</duplicate>
    <additional>
        <secure3d>
            <auth-form>https://3dsecure.issuerbankdomain.com/sample_acs</auth-form>
            <auth-form-method/>
            <retransmit>
                <TermUrl>...</TermUrl>
                <PaReq>...</PaReq>
                <MD>...</MD>
                <SOME_PARAM_NAME>PARAM_VALUE</SOME_PARAM_NAME>
            </retransmit>
        </secure3d>
    </additional>
</response>
```

#### Описание параметров secure3d

| Название           | Тип    | Описание                                                                                 |
|--------------------|--------|------------------------------------------------------------------------------------------|
| auth-form          | string | URL страница ACS-авторизации банк-эмитента.                                              |
| auth-form-method   | string | Необходимый тип запроса. GET/POST, если не задан, POST по умолчанию.                     |
| retransmit         | array  | Параметры, которые необходимо передавать в банк-эмитент, в виде параметров HTTP запроса. |
| retransmit/PaReq   | string | Параметр для отправки на ACS банк-эмитента.                                              |
| retransmit/MD      | string | Параметр для отправки на ACS банк-эмитента.                                              |
| retransmit/TermUrl | string | URL страницы, куда плательщик будет возвращён по результату 3D-Secure авторизации.       |


